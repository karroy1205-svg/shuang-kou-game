<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>硬核山东双扣 - 商业正规桌</title>
    <link rel="stylesheet" href="style.css?v=9.0">
</head>
<body>
    <div id="lobby-screen">
        <div class="lobby-box">
            <h2>双扣在线大厅</h2>
            <div id="my-identity" style="color:#f1c40f; font-weight:bold; margin-bottom:15px;">连接中...</div>
            <div class="seat-container">
                <div class="seat" id="seat-0">空座</div>
                <div class="seat" id="seat-1">空座</div>
                <div class="seat" id="seat-2">空座</div>
                <div class="seat" id="seat-3">空座</div>
            </div>
            <div id="owner-panel" style="display:none; margin-top: 20px;">
                <select id="match-length">
                    <option value="5">5 局制</option>
                    <option value="10">10 局制</option>
                    <option value="15">15 局制</option>
                    <option value="20">20 局制</option>
                </select>
                <label style="color:#2ecc71; margin-right:15px; font-weight:bold; cursor:pointer;">
                    <input type="checkbox" id="reset-match-chk" checked> 重新计算比分
                </label>
                <button id="start-btn" disabled>等待全员准备</button>
            </div>
            <div id="player-panel" style="display:none; margin-top: 20px;"><button id="ready-btn">点我准备</button></div>
            <div id="spectator-panel" style="display:none; margin-top: 20px; color:#e74c3c;">观众模式 🍿 (<span id="spec-count">0</span>)</div>
        </div>
    </div>

    <div id="settlement-screen" style="display:none; position: fixed; inset: 0; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.85); z-index: 9999; justify-content: center; align-items: center; flex-direction: column;">
        <div class="lobby-box" style="background: #2c3e50; padding: 40px; border-radius: 12px; border: 2px solid #f1c40f; text-align: center; width: 450px; box-shadow: 0 0 30px rgba(0,0,0,0.9);">
            <h2 style="color: #f1c40f; margin-top: 0; font-size: 26px;">本局结算</h2>
            <div id="settlement-details" style="text-align: left; margin: 25px 0; font-size: 18px; line-height: 2;"></div>
            <button id="confirm-settlement-btn" style="background-color: #2ecc71; padding: 12px 30px; font-size: 18px; border: none; border-radius: 6px; cursor: pointer; color: white; font-weight: bold; width: 100%;">确认结算，进入下局</button>
            <div id="settlement-wait-msg" style="display:none; color: #bdc3c7; margin-top: 15px; font-size: 16px;">⏳ 等待其他玩家确认...</div>
        </div>
    </div>

    <div id="scoreboard">
        <div class="match-info" style="font-size: 14px;">
            第 <span id="current-game">0</span> 局 | 
            🏆 胜场: <span id="team1-name" style="color:#3498db;">[队1]</span> <b id="team1-wins" style="color:white; font-size:16px;">0</b> - <b id="team2-wins" style="color:white; font-size:16px;">0</b> <span id="team2-name" style="color:#e74c3c;">[队2]</span>
        </div>
        <div class="main-suit-display">主花色: <span id="main-suit-icon">?</span></div>
        <div class="team-info">🛡️ 台上: <span id="on-stage-players">...</span></div>
        <div class="team-info highlight">⚔️ 台下得分: <span id="score">0</span></div>
    </div>

    <div id="game-table">
        <div id="danmaku-container"></div>

        <div class="player-seat pos-north" id="player-north">
            <div class="avatar">👤<div class="timer-badge">0</div></div>
            <div class="info"><span class="name">待定</span><br>🎴 <span class="card-count">0</span></div>
            <div class="battle-slot" id="slot-north"></div>
        </div>
        <div class="player-seat pos-west" id="player-west">
            <div class="avatar">👤<div class="timer-badge">0</div></div>
            <div class="info"><span class="name">待定</span><br>🎴 <span class="card-count">0</span></div>
            <div class="battle-slot" id="slot-west"></div>
        </div>
        <div id="battle-area">
            <div id="deck-area" style="display:none;">
                <div class="pile" id="pile-left"></div>
                <div id="target-card-ui" class="target-card-display">?</div>
                <div class="pile" id="pile-right"></div>
                <div class="deck-count">剩余: <span id="cards-remain">108</span> 张</div>
            </div>
            <div id="public-cards-area"></div>
        </div>
        <div class="player-seat pos-east" id="player-east">
            <div class="avatar">👤<div class="timer-badge">0</div></div>
            <div class="info"><span class="name">待定</span><br>🎴 <span class="card-count">0</span></div>
            <div class="battle-slot" id="slot-east"></div>
        </div>
        <div class="player-seat pos-south" id="player-south">
            <div class="battle-slot" id="slot-south" style="top: -100px;"></div>
            <div class="avatar">👤<div class="timer-badge">0</div></div>
            <div class="info"><span class="name">自己</span></div>
        </div>
    </div>

    <div id="my-area">
        <div class="action-bar">
            <button id="highlight-toggle-btn" style="background-color: #f1c40f; color: #333;">✨ 主牌高亮</button>
            <div class="buttons">
                <button id="draw-btn" style="display:none; background-color:#3498db;">摸牌</button>
                <button id="call-btn" style="display:none; background-color:#9b59b6;">亮3定主</button>
                <button id="override-btn" style="display:none; background-color:#8e44ad;">双3反主</button>
                <button id="want-btn" style="display:none; background-color:#2ecc71;">我要底牌</button>
                <button id="take-bottom-btn" style="display:none; background-color:#27ae60;">拿走底牌</button>
                <button id="bury-btn" style="display:none; background-color:#c0392b;">确认扣底</button>
                <button id="pay-tribute-btn" style="display:none; background-color:#e74c3c;">进 贡</button>
                <button id="return-tribute-btn" style="display:none; background-color:#1abc9c;">还 供</button>
                <button id="play-btn" style="display:none; background-color:#e67e22;">出 牌</button>
            </div>
        </div>
        <div id="card-container"></div>
    </div>

    <div id="chat-window">
        <div class="chat-header" id="chat-header">房间交流与日志 💬</div>
        <ul id="chat-messages"></ul>
        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="按 Enter 发送弹幕..." maxlength="30">
            <button id="chat-send-btn">发送</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="game.js"></script>
</body>
</html>
